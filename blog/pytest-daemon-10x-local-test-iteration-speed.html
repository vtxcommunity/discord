<!DOCTYPE html><!-- Last Published: Tue Dec 19 2023 07:48:59 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="discordpages.webflow.io" data-wf-page="6102fadda3eb27bb56da0f57" data-wf-site="5f8dd67f8fdd6f51f0b50904">
<!-- Mirrored from discord.com/blog/pytest-daemon-10x-local-test-iteration-speed by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 02 Jan 2024 08:10:28 GMT -->
<head><meta charset="utf-8"/><title>pytest daemon: 10X Local Test Iteration Speed</title><meta content="At Discord, we utilize a Python monolith to power our API. But recently, it took a whopping 13 seconds to run a single test! Join engineer Ruby Feinstein as he tackles this situation and makes the process better for everyone on his team." name="description"/><meta content="pytest daemon: 10X Local Test Iteration Speed" property="og:title"/><meta content="At Discord, we utilize a Python monolith to power our API. But recently, it took a whopping 13 seconds to run a single test! Join engineer Ruby Feinstein as he tackles this situation and makes the process better for everyone on his team." property="og:description"/><meta content="https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png" property="og:image"/><meta content="pytest daemon: 10X Local Test Iteration Speed" property="twitter:title"/><meta content="At Discord, we utilize a Python monolith to power our API. But recently, it took a whopping 13 seconds to run a single test! Join engineer Ruby Feinstein as he tackles this situation and makes the process better for everyone on his team." property="twitter:description"/><meta content="https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/css/discordpages.7ab087c99.css" rel="stylesheet" type="text/css"/><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/60ae916347747e71167e21cc_favicon.png" rel="shortcut icon" type="image/x-icon"/><link href="../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/5f91fae62cc821206588b837_Frame%20246.png" rel="apple-touch-icon"/><link href="rss.xml" rel="alternate" title="RSS Feed" type="application/rss+xml"/><!-- Localize integration code -->
<script src="../../ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="../../global.localizecdn.com/localize.js"></script>
<script src="../webflow-scripts/head.js"></script>
<style>
  .nav-bar-hack {
  	bottom: 0px !important;
    height: auto !important;
  }
  
  body a.w-webflow-badge {
    display: none !important;
  }
  
  body {
  	text-rendering: optimizeLegibility;
  }
  
  @media screen and (max-width: 476px) {
    .hide-on-mobile {
      display: none;
    }
  }
  
  .hr-style {
  border: 0;
  height: 8px;
  background-color: #F0F0F0;
  margin: 20px 0px;
  }
  
  .BlogBodyQuote {
  grid-column: 2/-1;
  font-size: 24px;
  line-height: 36px;
  padding: 0px 0px 15px 40px;
  font-style: italic;
  margin: 40px 0px 50px 0px;
}

.quote-text {
  width: 100%;
  margin-top: 10px;
}

.quote-icon {
  position: relative;
  top: 16px;
}

footer.quote-footer {
  font-size: 16px;
  margin-top: 20px;
  font-style: normal;
}
</style>

<style>
.language{
    display:flex;
    user-select: none;
}
.language .lang-container {
    position: relative;
}

.language .lang-selector-container {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.language .locale-container{
    display: flex;
    align-items: center;
}

.language .flag {
    width: 24px;
    height: 16px;
    margin-right: 8px;
}

.language .selector-language-name{
    color: #fff;
    font-size: 14px;
    line-height: 18px;
}

.language .arrow-icon{
    padding-left: 8px;
}

.language .lang-dropdown-container {
    z-index: 10;
    bottom: 100%;
    margin-bottom: 8px;
    position: absolute;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 1px rgb(0 0 0 / 10%);
    overflow: hidden;
    display: none;
}

.language .lang-dropdown {
    max-height: 320px;
    min-width: 150px;
    overflow-x: hidden;
    overflow-y: auto;
    overscroll-behavior: contain;
}

.language .dropdown-item{
    padding: 8px;
}

.language .dropdown-clickable{
    cursor: pointer;
}

.language .dropdown-language-name{
    color: #23272a;
    font-size: 14px;
    line-height: 18px;
}

.flag-ru{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4da57001e8f59b8a77_62cb46f39e6ac4c46ce39566_ru.png);
}

.flag-bg{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cdbc0dc0fb5f55e3098f_6257c2a1e7544e303083b2b1_bolg.png);
}
.flag-cs{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4c83827a1284afe239_62cb46f1254305732a01676d_cs.png);
}
.flag-da{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4ad6ee377e0df4cde6_62cb46f16128094022db6768_da.png);
}
.flag-de{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4aa35fe71fedf5e95f_62cb46f1c50496ce73c40d99_de.png);
}
.flag-en-GB {
    content:url("https://assets-global.website-files.com/6257adef93867e50d84d30e2/62d01c2078d11b68a1633276_Rectangle 1 (3).svg");
}
.flag-el{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4ca5700115ec9b8a67_62cb46f17c26b5fe5a53876f_el.png);
}
.flag-en-US{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cdbc488f5f603e7ecd2a_6257bf8b5ba300233705a542_en.png);
}
.flag-en{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cdbc488f5f603e7ecd2a_6257bf8b5ba300233705a542_en.png);
}
.flag-es{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4b7670687b935aaed4_62cb46f14edab1b0029593fc_es-ES.png);
}
.flag-fi{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb48951dec0cce94a2b1_62cb46f1921c0cf82fc59da7_fi.png);
}
.flag-fr{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4a01339d451d474860_62cb46f1544a7ab7c66e9ccb_fr.png);
}
.flag-hi{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb47b3070262fdccd2a6_62cb46f13fcb6e76c05b504e_hi.png);
}
.flag-hr{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4764813ee14c33c45f_62cb46f1aeebe9064763c90c_hr.png);
}
.flag-hu{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb486b18c7334c564b9a_62cb46f19e6ac41dcce39561_hu.png);
}
.flag-it{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb47fcf6b11ce186dd29_62cb46f1bd099a25f8f77ea4_it.png);
}
.flag-ja{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb49fa4234bc13a595aa_62cb46f1e819841940bec47d_ja.png);
}
.flag-ko{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4b6b18c7266d564ba3_62cb46f125430509b9016776_ko.png);
}
.flag-lt{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4bc5fa8c17a80ae4c4_62cb46f14edab152b8959405_lt.png);
}
.flag-nl{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4d6b18c71a53564bac_62cb46f3e00ff80959abff2a_nl.png);
}
.flag-no{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4d29670fb8a9998a06_62cb46f37c26b5e22453877d_no.png);
}
.flag-pl{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4fd9e48ce2224e71b3_62cb46f3c504963019c40db7_pl.png);
}
.flag-pt-BR{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4d41e0514ceaeb0814_62cb46f3d809bc2503e62bec_pt-BR.png);
}
.flag-ro{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4b7b2666d9520e434e_62cb46f36e94d725ce411ab6_ro.png);
}
.flag-sv{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb5036a202f7044eb402_62cb46f49e6ac47674e39567_sv-SE.png);
}
.flag-th{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb502ab71d0c254b8e0c_62cb46f465c529bf26e211a1_th.png);
}
.flag-tr{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4f41e0515a89eb082a_62cb46f4e819848178bec4d1_tr.png);
}
.flag-uk{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4f36a20273d04eb401_62cb46f37c26b54f6a53877f_uk.png);
}
.flag-vi{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4f00801f3750f4834e_62cb46f4e819840d89bec4d2_vi.png);
}
.flag-zh-Hans{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb5010e73af938ef607e_62cb46f49e6ac45f35e39568_zh-CN.png);
}
.flag-zh-TW{
    content:url(../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/6321cb4fd354ea61ac8db41c_62cb46f33fcb6ea5c95b5069_zh-TW.png);
}
</style>

<style>
.btn-wrapper a {
  color: #fff ;
}

/*
strong {
  font-weight: 700!important;
  font-size: 32px!important;
}
*/
</style>

</head><body><div style="background-color:#5865f2" class="header-blue-blog"><div data-w-id="268ebfa3-e656-b800-3b97-3f7bdfa2ec4d" class="blog-navbar"><a href="../blog.html" class="blog-brand-copy w-nav-brand"><img src="https://assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/613b8fc3834b2bd42157bc04_blogwhite.svg" loading="lazy" alt="Discord"/></a><div data-collapse="medium" data-animation="over-right" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-5 w-nav"><div class="container-790 w-container"><nav role="navigation" class="blog-nav w-nav-menu"><div data-delay="100" data-hover="true" class="w-dropdown"><div class="w-dropdown-toggle"><img src="https://assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/635157e8f94a8580bcbb3e32_Shape.svg" loading="lazy" alt="" class="icon mobile"/><img src="https://assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/614275ac3d35134cb2a96b63_down.svg" loading="lazy" alt="" class="icon white"/><div class="blog-nav-item">COLLECTIONS</div></div><nav class="dropdown-list w-dropdown-list"><div class="w-dyn-list"><div role="list" class="w-dyn-items"><div role="listitem" class="w-dyn-item"><a href="../category/community.html" class="dropdown-link w-dropdown-link">Community</a></div><div role="listitem" class="w-dyn-item"><a href="../category/company.html" class="dropdown-link w-dropdown-link">Discord HQ</a></div><div role="listitem" class="w-dyn-item"><a href="../category/engineering.html" class="dropdown-link w-dropdown-link">Engineering &amp; Developers</a></div><div role="listitem" class="w-dyn-item"><a href="../category/how-to-discord.html" class="dropdown-link w-dropdown-link">How to Discord</a></div><div role="listitem" class="w-dyn-item"><a href="../category/safety.html" class="dropdown-link w-dropdown-link">Policy &amp; Safety</a></div><div role="listitem" class="w-dyn-item"><a href="../category/product.html" class="dropdown-link w-dropdown-link">Product &amp; Features</a></div></div></div></nav></div><a href="../blog-featured.html" class="blog-nav-item w-nav-link">Featured</a><a href="../index.html" class="blog-nav-item w-nav-link">Discord.com</a><div class="w-embed"><form action="https://discord.com/blog/search" class="form-search w-form" style="display: flex">
<input type="search" class="text-field w-input" maxlength="256" name="query" placeholder="Search…" id="search" required="">
<input type="submit" value="" class="btn-search w-button">
</form>

<style> 
form.form-search.w-form:focus-within {
    border: 1px solid #fff;
}
</style></div><form action="https://discord.com/search" class="form-search w-form"><input type="search" class="text-field w-input" maxlength="256" name="query" placeholder="Search…" id="search" required=""/><input type="submit" value="" class="btn-search w-button"/></form></nav><div class="w-nav-button"><img src="https://assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/60b6ad79b75c18f025626c71_menuicon.svg" loading="lazy" alt="Menu" class="image-14"/></div></div></div></div></div><div style="background-color:#5865f2" class="blog-home-hero-header"></div><div class="blog-featured-section"><div class="blog-hero-container hero-offset w-dyn-list"><div role="list" class="collection-list w-dyn-items"><div role="listitem" class="collection-item-4 w-dyn-item"><div class="div-block-15"><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png" loading="lazy" alt="" sizes="(max-width: 767px) 92vw, (max-width: 991px) 90vw, (max-width: 1279px) 91vw, (max-width: 1919px) 92vw, 1368px" srcset="https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-500.png 500w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-800.png 800w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-1080.png 1080w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-1600.png 1600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-2000.png 2000w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-2600.png 2600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-3200.png 3200w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png 3600w" class="image-19"/></div><div class="blog-hero-heading-section"><a href="../category/engineering.html" class="blog-hero-category">Engineering &amp; Developers</a><a href="pytest-daemon-10x-local-test-iteration-speed.html" aria-current="page" class="blog-hero-heading w--current">pytest daemon: 10X Local Test Iteration Speed</a></div></div></div></div></div><div class="blog-post-container new"><div class="column-wrapper w-row"><div class="column-3 w-col w-col-2 w-col-stack"><div class="the-author-section"><img alt="" loading="lazy" width="72" src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65735b50b19d0a28b71e1eec_Ruby%20314x.png" class="image-22"/><div><div class="blog-post-author">Ruby Feinstein</div><div class="blog-post-author-name">December 8, 2023</div></div></div><div class="tag-section w-condition-invisible"><div class="divider-bar-copy"></div><div class="tags-sections-head">Tags</div><div class="collection-list-wrapper-2 w-dyn-list"><div class="empty-state w-dyn-empty"></div></div></div></div><div class="column-4 w-col w-col-8 w-col-stack"><div id="heading-1" class="rich-wrapper"><div class="blog-post-content w-richtext"><p>At Discord, we utilize a Python monolith to power our <a href="../developers/docs/reference.html">API</a>, from sending messages to managing Nitro subscriptions. To support this, we use <a href="https://github.com/pytest-dev/pytest">pytest</a> to write and run unit tests. </p><p>Over the last 8 years, the time it takes to run a single test has continuously grown until it reached a point where it takes a whopping 13 seconds to run a single test. </p><p>To clarify, even if the test ends up doing absolutely nothing, 13 seconds is the bare minimum it takes:</p><div class="w-embed w-script"><script src="../../gist.github.com/DiscordBlog/d824641a57d3487e7fb96394a87cadca.js"></script></div><p>Most of the testing time is spent in our global <strong>conftest.py</strong> file, which contains slow imports and fixtures with <strong>scope=session</strong>. We refer to this internally as &quot;importing the universe,&quot; and to say it straight: the lack of dependency boundaries in this project is an issue that’s worsened with time. We’re actively working to address this in the long term by breaking our monolith into modules, reducing the number of imports &amp; fixtures required to run a single test.</p><p>However, since running a single unit test happens frequently, we started looking into potential stop-gap solutions.</p></div></div><div class="btn-wrapper w-condition-invisible"><a href="#" class="btn-blog w-dyn-bind-empty w-button"></a></div><div id="heading-2" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2>Why is it important?</h2><p>Simply put: humans get distracted. When I’m waiting for a test for more than a few seconds, I might click on a notification, open my browser, or get distracted for a few minutes. These distractions extend the feedback loop and make me less efficient in completing my current task.</p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" style="max-width:413pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/657257bafeeb80b48e72c137_compiling.png" alt="An XKCD comic. Two engineers are swordfighting, looking as if they&#x27;re not working. The caption reads: &quot;The #1 programmer excuse for legitimately slacking off: &#x27;My code&#x27;s compiling.&#x27;&quot;"/></div><figcaption><a href="https://3d.xkcd.com/303/"><em>https://3d.xkcd.com/303/</em></a></figcaption></figure></div></div><div id="heading-3" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2>Solution: Wait ahead of time!</h2><p>After tinkering for a bit, I came up with a simple but imperfect solution that can speed things up significantly which I call “pytest daemon.” The gist of the approach is to have an already-loaded process on standby, letting us run any test quickly without having to wait for a new Python process to import.</p><p>Our daemon manager watches for any code changes, and if something changes, a new process is spawned.</p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" style="max-width:2000pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65725a338ca0f27dc38d69f9_Flowchart.png" loading="lazy" alt="A flowchart that goes as such: &quot;Dev -&gt; Test -&gt; daemon manager -&gt; daemon&quot;"/></div></figure><p>The difference between utilizing a vanilla test and running a test with the daemon involves replacing the regular pytest command: you use a script that transforms the arguments into a REST HTTP request. This is then sent to the daemon manager, which proxies the request to the active daemon.</p></div></div><div id="heading-4" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2><strong>Here be dragons:</strong> Hot reloading</h2><p>So, it’s time to get to work: let’s assume we have a process ready to run some tests, but then we end up making one last change — should we wait a whole 13 seconds for a new process to start? Pfft… nahh! We can call upon the dark arts of:</p><div class="w-embed w-script"><script src="../../gist.github.com/DiscordBlog/722e4bc4e37230330377ca8a8b0206d8.js"></script></div><p>To utilize our tactic, we’ll need to determine which modules need to be reloaded and the order they should be reloaded. For instance, if we have the following imports:</p><figure class="w-richtext-figure-type-image w-richtext-align-center" style="max-width:" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65725adf90e0e3bcaa3f64e6_Screenshot%202023-12-07%20at%203.52.46%e2%80%afPM.png" loading="lazy" alt="A flowchart with two paths. One goes: &quot;Test -&gt; import -&gt; view -&gt; import -&gt; model.&quot; The other goes: &quot;test -&gt; import - model&quot;"/></div></figure><ul role="list"><li>If <strong>test.py</strong> is modified, we only need to reload it.</li><li>If <strong>view.py</strong> is modified, we need to reload <strong>view.py</strong>, <strong>test.py</strong>, in that order.</li><li>if <strong>model.py</strong> is modified, we need to reload <strong>model.py</strong>, <strong>view.py</strong>, <strong>test.py</strong>, in that exact order.</li></ul><p>To know which files to load, our daemon manager starts by analyzing all our source code:</p><ol role="list"><li>Build an import graph for our code, where each node is pointing to all the files that directly import it (reversing the import graph):</li></ol><figure class="w-richtext-figure-type-image w-richtext-align-center" style="max-width:" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65725b1754caa81aae5cc169_Screenshot%202023-12-07%20at%203.53.37%e2%80%afPM.png" loading="lazy" alt="A flowchart with two paths. One goes: &quot;model -&gt; dependancy -&gt; test.&quot; The other goes &quot;model -&gt; dependancy -&gt; view -&gt; dependancy -&gt; test.&quot;"/></div></figure><ol role="list"><li>Create a topological sort of the dependencies graph from step one. For example: <strong>[model.py, view.py, test.py]</strong></li><li>When a file is modified, use the graph from step one to get a mapping from each python file to all other files that import it directly. In case we have multiple files, we sort them based on their topological sort from step two.</li></ol><blockquote>💡 Without using topological sort, we might create the wrong reload order. Consider what will happen if <strong>model</strong> is modified and we choose to reload using the following order: <strong>model, test, view</strong>? Now, when executing <strong>importlib.reload(test)</strong> it will keep a reference to an old version of <strong>view</strong> which, in turn, still uses an obsoleted version of <strong>model</strong>.</blockquote><p>Reloading the files in the right order doesn’t solve all of our issues. Consider the following task decorator, which has the below sanity check:</p><div class="w-embed w-script"><script src="../../gist.github.com/DiscordBlog/2beb82bb1a7c2a00b3fc021aea08ab83.js"></script></div><div class="w-embed w-script"><script src="../../gist.github.com/DiscordBlog/f37cf2685b6b0649a906d7d27a55fd85.js"></script></div><p>In the example above, reloading <strong>task.py</strong> will raise an exception! To work around these kinds of issues, we added a patching point:</p><div class="w-embed w-script"><script src="../../gist.github.com/DiscordBlog/120ba383f038758c90d574c2e5f8f584.js"></script></div><p>To fix the example above, we can implement the following patch:</p><div class="w-embed w-script"><script src="../../gist.github.com/DiscordBlog/c01d314c49868a2acbad9aaeaba4797e.js"></script></div><p>Hard as we try, there might be cases where hot-reloading fails or where it’s simply not worth the effort to work around these failures, which is why we always start a new, clean process in parallel to our reloading attempts. If our new method doesn’t work, we still have ol’ reliable within at most 13 seconds from the last save.</p></div></div><div id="heading-5" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2>How Much Faster Is It?</h2><p>It’s <strong>so</strong> fast. Just look at these results:</p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" style="max-width:2734pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65725d02f8432d5f01ef30a6_Screenshot%202023-12-07%20at%204.01.59%e2%80%afPM.png" loading="lazy" alt="A table comparing two results. One row reads: &quot;empty test with daemon, .4 seconds, without daemon, 12.7 seconds.&quot; The second row reads &quot;complex test with many dependancies, with daemon 3.9/2.4/2.4 seconds, without daemon 17.5 seconds.&quot;"/></div></figure><p>A few notes when looking at these results:</p><ol role="list"><li>Running the daemon multiple times can improve results in case additional one-time work was triggered, for example, if additional modules were loaded.</li><li>Running our “empty test” on vanilla python without any imports or <a href="https://conftest.py/">conftest.py</a> takes 0.6 seconds, which means our stop-gap solution is faster than we could ever get by removing unneeded imports or fixtures.</li></ol><p>Looking at aggregated runs of our users in a given month, <strong>we found that we reduced the median test duration from 20 seconds down to 2 seconds!</strong></p></div></div><div id="heading-6" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2>VS Code Integration</h2><p>Using pytest is well supported by popular IDEs like VS Code. However, our pytest daemon breaks some of its functionality. To address this, we developed a small plugin that provides the following features:</p><ol role="list"><li>Test the current method.</li><li>Run all tests in the current file.</li><li>Repeat the last run.</li><li>Start the daemon manager.</li><li>Force a full reload of the daemon in case of any issues.</li></ol><p>While our plugin may not be as good as the built-in integration, it’s a close approximation. A speed trade-off is worth sacrificing some fancy features.</p><p>It’s important to note that debugging still works seamlessly. By debugging the daemon manager, VS Code automatically attaches to any child process spawned, with all breakpoints functioning as expected.</p></div></div><div id="heading-7" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2>Open Source Projects</h2><p>While drafting this blog post, I searched around the web to see if anyone else was having a similar issue and found an open source project that implemented a similar approach. It even used the same name! </p><p>Both projects were created independently around the same time, which is pretty cool. Great minds think alike! </p><p>If you run into a similar issue, consider checking their work out: <a href="https://github.com/JamesHutchison/pytest-hot-reloading/">https://github.com/JamesHutchison/pytest-hot-reloading/</a></p><p></p></div></div><div id="heading-8" class="rich-wrapper"><div class="blog-post-content w-richtext"><h2>Side Quest Conclusion</h2><p>Our 15 seconds import time is still there, but now we can focus on improving it properly, with pytest daemon being the stop-gap solution we needed. </p><p>One of our Company Principles is <strong>Progress Over Perfection:</strong></p><blockquote><em>All big things start small. Think long-term and break ideas down so you can start delivering value and learning right away. Strive for an 80/20 approach and compound from there. This is the essence of moving fast with both excellence and surprise &amp; delight.</em></blockquote><p>Building the first iteration of pytest daemon was about a week of work and it was a fun challenge that supported our goal of helping our engineers move faster! My initial version was published as an opt-in version our engineers could use, and after incorporating their feedback, we started migrating most of our local dev flows to use it. </p><p>I keep iterating on it every few weeks to see what small improvements would make our engineers move faster or resolve any issues preventing certain teammates from leveraging it).</p><p>Speaking of moving faster, I used ChatGPT4 and GitHub Copilot to speed up my progress. Specifically:</p><ul role="list"><li>Building my first VSCode extension was straightforward.</li><li>Asking ChatGPT to write a script to analyze all the imports in our code generated a relatively good starting point.</li></ul><p>If improving developer environments work excites you <a href="../careers.html">check out our careers page</a>. At the time of publishing, we’re actively hiring for our developer environments team!</p><p></p></div></div><div id="heading-9" class="rich-wrapper"><div class="blog-post-content w-dyn-bind-empty w-richtext"></div></div><div id="heading-10" class="rich-wrapper"><div class="blog-post-content w-dyn-bind-empty w-richtext"></div></div></div><div class="column-desctop w-col w-col-2 w-col-stack"><div class="rich-content-right"><div class="paragraph-medium bot-marg">Contents</div><a href="#heading-1" class="title-menu-anchor">Intro</a><a href="#heading-2" class="title-menu-anchor">Why&#x27;s it important?</a><a href="#heading-3" class="title-menu-anchor">Solution: Wait!</a><a href="#heading-4" class="title-menu-anchor">Hot reloading</a><a href="#heading-5" class="title-menu-anchor">How Fast Is It?</a><a href="#heading-6" class="title-menu-anchor">VS Code Integration</a><a href="#heading-7" class="title-menu-anchor">Open Source Projects</a><a href="#heading-8" class="title-menu-anchor">Conclusion</a><a href="#heading-9" class="title-menu-anchor w-dyn-bind-empty"></a><a href="#heading-10" class="title-menu-anchor w-dyn-bind-empty"></a></div></div></div><div class="divider-bar"></div><div class="blog-column w-row"><div class="w-col w-col-3 w-col-medium-6"><div class="author-title">THE AUTHOR</div></div><div class="w-col w-col-9 w-col-medium-6"><div class="the-author-section footer"><img alt="" loading="lazy" width="47" src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65735b50b19d0a28b71e1eec_Ruby%20314x.png" class="blog-post-author-image-footer"/><div><div class="blog-post-author-footer">Ruby Feinstein</div><div class="blog-post-author-desc">Ruby joined Discord in 2022. He loves all things efficient in his life, from making Discord feel online even on a slow connection, to speeding up Pytest testing sessions. Like many Discordians, he’s a gamer of all kinds and is known to participate in weekend hacking shenanigans. His current game is Tears of the Kingdom.</div></div></div></div></div><div class="divider-bar"></div><div><div class="author-title">MORE FROM</div><div class="category-title-footer">Engineering &amp; Developers</div><div class="footer-more-from w-dyn-list"><div role="list" class="featured-small-list w-dyn-items w-row"><div role="listitem" class="collection-item-small blog w-dyn-item w-col w-col-4"><a href="pytest-daemon-10x-local-test-iteration-speed.html" aria-current="page" class="link-block-4 w-inline-block w--current"><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png" loading="lazy" alt="" sizes="(max-width: 767px) 83vw, (max-width: 991px) 29vw, (max-width: 1439px) 30vw, 434.6625061035156px" srcset="https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-500.png 500w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-800.png 800w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-1080.png 1080w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-1600.png 1600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-2000.png 2000w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-2600.png 2600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1)-p-3200.png 3200w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png 3600w" class="blog-featured-small-image"/></a><a href="../category/engineering.html" class="blog-hero-category">Engineering &amp; Developers</a><a href="pytest-daemon-10x-local-test-iteration-speed.html" aria-current="page" class="link-block-20 w-inline-block w--current"><div class="blog-featured-title-small">pytest daemon: 10X Local Test Iteration Speed</div></a></div><div role="listitem" class="collection-item-small blog w-dyn-item w-col w-col-4"><a href="ddevs-celebrates-250k-members.html" class="link-block-4 w-inline-block"><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65690639d911b0d8f5dc758e_DDevs_250k_blogheader.png" loading="lazy" alt="" sizes="(max-width: 767px) 83vw, (max-width: 991px) 29vw, (max-width: 1439px) 30vw, 434.6625061035156px" srcset="https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65690639d911b0d8f5dc758e_DDevs_250k_blogheader-p-500.png 500w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65690639d911b0d8f5dc758e_DDevs_250k_blogheader-p-800.png 800w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65690639d911b0d8f5dc758e_DDevs_250k_blogheader-p-1080.png 1080w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65690639d911b0d8f5dc758e_DDevs_250k_blogheader-p-1600.png 1600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/65690639d911b0d8f5dc758e_DDevs_250k_blogheader.png 1800w" class="blog-featured-small-image"/></a><a href="../category/engineering.html" class="blog-hero-category">Engineering &amp; Developers</a><a href="ddevs-celebrates-250k-members.html" class="link-block-20 w-inline-block"><div class="blog-featured-title-small">The DDevs Server Celebrates 250k Members!</div></a></div><div role="listitem" class="collection-item-small blog w-dyn-item w-col w-col-4"><a href="authentication-outage.html" class="link-block-4 w-inline-block"><img src="../../assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203.png" loading="lazy" alt="" sizes="(max-width: 767px) 83vw, (max-width: 991px) 29vw, (max-width: 1439px) 30vw, 434.6625061035156px" srcset="https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-500.png 500w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-800.png 800w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-1080.png 1080w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-1600.png 1600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-2000.png 2000w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-2600.png 2600w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203-p-3200.png 3200w, https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/63178bf5d9f1714116f6a66d_Resources%20%26%20Education%20-%203.png 3600w" class="blog-featured-small-image"/></a><a href="../category/engineering.html" class="blog-hero-category">Engineering &amp; Developers</a><a href="authentication-outage.html" class="link-block-20 w-inline-block"><div class="blog-featured-title-small">25% or 6 to 4: The 11/6/23 Authentication Outage</div></a></div></div></div></div></div><div class="footer-black"><div class="container-1180px-2"><div class="w-layout-grid grid-footer"><div id="w-node-_4154f574-5821-8ddb-f6fc-12aae7b6c861-e7b6c85e" class="vertical-flex"><div data-hover="false" data-delay="0" class="dropdown-3 w-dropdown"><div class="dropdown-toggle w-dropdown-toggle"><img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/6257bee91e6309a5a6f6b994_arrow.svg" loading="lazy" alt="" class="arrow"/><div>English, USA</div></div><nav class="dropdown-list-5 w-dropdown-list"><a href="#" class="dropdown-link-2 w-dropdown-link">български</a><a href="#" class="dropdown-link-2 czech w-dropdown-link">Čeština</a><a href="#" class="dropdown-link-2 dansk w-dropdown-link">Dansk</a><a href="#" class="dropdown-link-2 deutsch w-dropdown-link">Deutsch</a><a href="#" class="dropdown-link-2 greek w-dropdown-link">Ελληνικά</a><a href="#" class="dropdown-link-2 english w-dropdown-link">English, USA</a><a href="#" class="dropdown-link-2 spanish w-dropdown-link">Español</a><a href="#" class="dropdown-link-2 suomi w-dropdown-link">Suomi</a><a href="#" class="dropdown-link-2 french w-dropdown-link">Français</a><a href="#" class="dropdown-link-2 hindi w-dropdown-link">हिंदी</a><a href="#" class="dropdown-link-2 hrvatski w-dropdown-link">Hrvatski</a><a href="#" class="dropdown-link-2 magyar w-dropdown-link">Magyar</a><a href="#" class="dropdown-link-2 italiano w-dropdown-link">Italiano</a><a href="#" class="dropdown-link-2 japanese w-dropdown-link">日本語</a><a href="#" class="dropdown-link-2 korean w-dropdown-link">한국어</a><a href="#" class="dropdown-link-2 lithuanian w-dropdown-link">Lietuviškai</a><a href="#" class="dropdown-link-2 nederlands w-dropdown-link">Nederlands</a><a href="#" class="dropdown-link-2 norwegian w-dropdown-link">Norwegian</a><a href="#" class="dropdown-link-2 polski w-dropdown-link">Polski</a><a href="#" class="dropdown-link-2 brazilian-portuguese w-dropdown-link">Português do Brasil</a><a href="#" class="dropdown-link-2 romania w-dropdown-link">Română</a><a href="#" class="dropdown-link-2 ru w-dropdown-link">Русский</a><a href="#" class="dropdown-link-2 svenska w-dropdown-link">Svenska</a><a href="#" class="dropdown-link-2 thai w-dropdown-link">ไทย</a><a href="#" class="dropdown-link-2 turkey w-dropdown-link">Türkçe</a><a href="#" class="dropdown-link-2 ua w-dropdown-link">Українська</a><a href="#" class="dropdown-link-2 vietnamese w-dropdown-link">Tiếng Việt</a><a href="#" class="dropdown-link-2 chinese1 w-dropdown-link">中文</a><a href="#" class="dropdown-link-2 chinese w-dropdown-link">繁體中文</a></nav></div><div class="language"><div class="lang-container"><div id="locale-dropdown" class="lang-dropdown-container"><div class="lang-dropdown"></div></div><div class="lang-selector-container"><div class="locale-container"><img src="https://assets-global.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg" alt="" class="flag"/><div class="selector-language-name"></div></div><img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/6257bee91e6309a5a6f6b994_arrow.svg" loading="lazy" alt="" class="arrow-icon"/></div></div></div><div class="flex-horizontal top-soc"><a data-track="twitter" href="https://twitter.com/discord" target="_blank" class="link-s w-inline-block"><img src="https://assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/65814ad8d9f0b3d89c08fdad_X.svg" loading="lazy" alt="" class="image-49"/></a><a data-track="instagram" href="https://www.instagram.com/discord/" target="_blank" class="link-s w-inline-block"><img src="https://assets-global.website-files.com/6238e97f6441e30a13a52345/6436b5ef634f834a45100cff_svg4.svg" loading="lazy" alt="" class="image-49"/></a><a data-track="facebook" href="https://www.facebook.com/discord/" target="_blank" class="link-s w-inline-block"><img src="https://assets-global.website-files.com/6238e97f6441e30a13a52345/6436b5ef634f836372100cfc_svg5.svg" loading="lazy" alt="" class="image-49"/></a><a data-track="youtube" href="https://www.youtube.com/discord" target="_blank" class="link-s w-inline-block"><img src="https://assets-global.website-files.com/6238e97f6441e30a13a52345/6436b5ef634f83240a100cfe_svg6.svg" loading="lazy" alt="" class="image-49"/></a><a data-track="Tiktok" href="https://www.tiktok.com/@discord" target="_blank" class="link-s w-inline-block"><img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/6374a8122d8df285ddea0e9e_Tiktok (1).svg" loading="lazy" alt="" class="image-49"/></a></div></div><div id="w-node-_4154f574-5821-8ddb-f6fc-12aae7b6c8b6-e7b6c85e"><div class="paragraph-small top-marg font-blue">Product</div><a data-track="download" href="../download.html" class="link-footer">Download</a><a data-track="nitro" href="../nitro.html" class="link-footer">Nitro</a><a data-track="status" href="https://discordstatus.com/" class="link-footer">Status</a><a data-track="status" href="../application-directory.html" class="link-footer">App Directory</a><a data-track="status" href="../mobile.html" class="link-footer">New Mobile Experience</a></div><div id="w-node-_4154f574-5821-8ddb-f6fc-12aae7b6c8bf-e7b6c85e"><div class="paragraph-small top-marg font-blue">Company</div><a data-track="about" href="../company.html" class="link-footer">About</a><a data-track="jobs" href="../careers.html" class="link-footer">Jobs</a><a data-track="branding" href="../branding.html" class="link-footer">Brand</a><a data-track="newsroom" href="../newsroom.html" class="link-footer">Newsroom</a><a data-track="newsroom" href="../fallrelease.html" class="link-footer">Fall Release</a></div><div id="w-node-_4154f574-5821-8ddb-f6fc-12aae7b6c8ca-e7b6c85e"><div class="paragraph-small top-marg font-blue">Resources</div><a data-track="college" href="../college.html" class="link-footer">College</a><a data-track="support" href="https://support.discord.com/hc" class="link-footer">Support</a><a data-track="safety" href="../safety.html" class="link-footer">Safety</a><a data-track="blog" href="../blog.html" class="link-footer">Blog</a><a data-track="feedback" href="https://support.discord.com/hc/en-us/community/topics" class="link-footer">Feedback</a><a data-track="streamkit" href="../streamkit.html" class="link-footer">StreamKit</a><a data-track="creators" href="../creators.html" class="link-footer">Creators</a><a data-track="community" href="../community.html" class="link-footer">Community</a><a data-track="Build" href="../build.html" class="link-footer">Developers</a><a data-track="Build" href="../gaming.html" class="link-footer">Gaming</a><a data-track="store" href="https://discordmerch.com/evergreenfooter" class="link-footer">Official 3rd Party Merch</a></div><div id="w-node-_4154f574-5821-8ddb-f6fc-12aae7b6c8e1-e7b6c85e"><div class="paragraph-small top-marg font-blue">Policies</div><a data-track="terms" href="../terms.html" class="link-footer">Terms</a><a data-track="privacy" href="../privacy.html" class="link-footer">Privacy</a><a data-open-cookie-settings="true" href="#" class="link-footer">Cookie Settings</a><a data-track="guidelines" href="../guidelines.html" class="link-footer">Guidelines</a><a data-track="acknowledgement" href="../acknowledgements.html" class="link-footer">Acknowledgements</a><a data-track="licenses" href="../licenses.html" class="link-footer">Licenses</a><a data-track="moderation" href="../safety-library.html" class="link-footer">Moderation</a></div></div><div class="footer-line-blue"><a data-track="logo" href="../index.html" class="w-inline-block"><img src="https://assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/64cb9ed63bb88490555f45a1_Open Source Projects _ Discord-7.svg" loading="lazy" alt="" class="discord-footer"/></a><a data-track="login_footer" href="../app.html" class="button-white color-blue-right footer-open-discord-button footer-open-discord-button-js w-button">Sign up</a></div></div></div><script src="../../d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c84fb4.js?site=5f8dd67f8fdd6f51f0b50904" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="../../assets-global.website-files.com/5f8dd67f8fdd6f51f0b50904/js/discordpages.790f5716f.js" type="text/javascript"></script><script type="text/javascript" src="../w/loader/loader.js" async defer></script>
<script src="../webflow-scripts/bodyEnd.js" defer async></script>
<script>
  function initDownloadButton() {
    let userAgent = window.navigator.userAgent,
        platform = window.navigator.platform,
        macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'],
        windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'],
        iosPlatforms = ['iPhone', 'iPad', 'iPod'],
        buttonAttributes = null;

    if (iosPlatforms.indexOf(platform) !== -1) {
      buttonAttributes = {
        text: "Download on the App Store",
        href: "https://itunes.apple.com/us/app/discord-chat-for-games/id985746746",
      }
    } else if (macosPlatforms.indexOf(platform) !== -1) {
      buttonAttributes = {
        text: "Download for Mac",
        href: "https://discord.com/api/download?platform=osx",
      }
    } else if (windowsPlatforms.indexOf(platform) !== -1) {
      buttonAttributes = {
        text: "Download for Windows",
        href: "https://discord.com/api/download?platform=win",
      }
    } else if (/Android/.test(userAgent)) {
      buttonAttributes = {
        text: "Download on Google Play",
        href: "https://play.google.com/store/apps/details?id=com.discord",
      }
    } else if (!os && /Linux/.test(platform)) {
      buttonAttributes = {
        text: "Download for Linux",
        href: "https://discord.com/api/download?platform=linux",
      }
    }

	let downloadEl = document.querySelectorAll(".download-button");
    if (downloadEl) {
      downloadEl.forEach(function(el) {
        el.innerText = buttonAttributes.text;
        el.href = buttonAttributes.href;
      });
    }

	let downloadSidebarEl = document.querySelectorAll(".download-sidebar");
    if (downloadSidebarEl) {
      downloadSidebarEl.forEach(function(el) {
        el.href = buttonAttributes.href;
      });
    }
  }
  
  function initLogInOrOpenDiscordButton() {
    let loginButtonText, loginRoute, signUpButtonText, signupRoute;
    let loginIsOpenDiscordButton = true;
    const loginLink = '../login.html';
    const signupLink = '../register.html';
    const openLink = '../channels/%40me.html';
    
    if(window.localStorage.getItem("token") != null) {
      loginButtonText = "Open Discord";
      loginRoute = openLink;
      loginIsOpenDiscordButton = true;
      
      signUpButtonText = "Open Discord";
      signupRoute = openLink;
    } else {
      loginIsOpenDiscordButton = false;
      loginButtonText = "Login";
      signUpButtonText = "Sign up";
      loginRoute = loginLink;
      signupRoute = signupLink;
    }
    
    let loginEl = document.querySelectorAll(".login-button-js");
    let footerEl = document.querySelectorAll(".footer-open-discord-button-js");
    if (loginEl && loginEl.length > 0) {
      loginEl.forEach(function(el) {
        if (!loginIsOpenDiscordButton) {
        	el.classList.add('hide-on-mobile');
        }
        el.innerText = loginButtonText;
      	el.href = loginRoute;
        if (loginIsOpenDiscordButton) {
            el.dataset.trackNav = 'navbar-open-button';
        }
      });
    }
    if (footerEl && footerEl.length > 0) {
      footerEl.forEach(function(el) {
        if (window.innerWidth <= 768) {
        	el.innerText = "Download";
        } else {
        	el.innerText = signUpButtonText;
        }
        el.href = signupRoute;
      });
    }
  }
  
  function initSignUpOrOpenButtons() {
    const signupLink = '../register.html';
    const openLink = '../channels/%40me.html';
    const isLoggedIn = window.localStorage.getItem("token") != null;
    const buttonEl = document.querySelectorAll(".open-or-signup-js");
    
    if (buttonEl && buttonEl.length > 0) {
        buttonEl.forEach(function(el) {
            if (isLoggedIn) {
                el.innerText = 'Open Discord';
                el.href = openLink;
            } else {
                el.innerText = 'Sign up';
                el.href = signupLink;
            }
        });
    }
  }
  
  initSignUpOrOpenButtons();
  initLogInOrOpenDiscordButton();
  initDownloadButton();
</script>


<!-- build:inlineScriptNonceTag -->
  <script>
  <!-- endbuild -->
  </script>
  <!-- section:dataLayer -->
  <script src="../assets/oneTrust/v4/scripttemplates/otSDKStub.js" type="text/javascript" charset="UTF-8" data-domain-script="04da1d72-0626-4fff-b3c6-150c719cc115"></script>
  <!-- build:inlineScriptNonceTag -->
  <script>
    <!-- endbuild -->
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({ 'allCookiesOK': false });
  </script>
  <!-- endsection -->
  <!-- section:gtm -->
  <!-- build:inlineScriptNonceTag -->
  <script>
  <!-- endbuild -->
    (function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          '../../www.googletagmanager.com/gtm5445.html?id=' + i + dl + '&gtm_auth=GI0g9O-54_SitcgmxQKxlA&gtm_preview=env-2&gtm_cookies_win=x'; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-N7BVC2W');
  </script>
  <!-- endsection --><script type="application/ld+json">
{ 
 "@context": "http://schema.org", 
 "@type": "BlogPosting",
 "headline": "pytest daemon: 10X Local Test Iteration Speed",
 "image": "https://assets-global.website-files.com/5f9072399b2640f14d6a2bf4/6555194328bacbf541b78da4_Engineering%20-%202%20(1).png",
 "publisher": "Discord",
 "url": "https://discord.com/blog/pytest-daemon-10x-local-test-iteration-speed",
 "datePublished": "Dec 12, 2023",
 "dateCreated": "Dec 07, 2023",
 "dateModified": "Dec 08, 2023",
 "description": "At Discord, we utilize a Python monolith to power our API. But recently, it took a whopping 13 seconds to run a single test! Join engineer Ruby Feinstein as he tackles this situation and makes the process better for everyone on his team. ",
   "author": {
    "@type": "Person",
    "name": "Ruby Feinstein"
  }
 }
</script>

<script nonce="MywxNzksMTgwLDIzOCwyMCw5NywxMCwxMTg=">(function(){var js = "window['__CF$cv$params']={r:'83f176773b363f77',t:'MTcwNDE4MjM2Ny45MTgwMDA='};_cpo=document.createElement('script');_cpo.nonce='MywxNzksMTgwLDIzOCwyMCw5NywxMCwxMTg=',_cpo.src='../cdn-cgi/challenge-platform/h/g/scripts/jsd/74bd6362/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = 'MywxNzksMTgwLDIzOCwyMCw5NywxMCwxMTg=';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
<!-- Mirrored from discord.com/blog/pytest-daemon-10x-local-test-iteration-speed by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 02 Jan 2024 08:10:38 GMT -->
</html>